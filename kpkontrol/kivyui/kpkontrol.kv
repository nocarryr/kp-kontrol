#: import icon kpkontrol.kivyui.garden.iconfonts.icon
#: include kpkontrol/kivyui/transport.kv
#: include kpkontrol/kivyui/cliplist.kv

RootWidget:
    app: app
    header_widget: header_widget
    main_widget: main_widget
    footer_widget: footer_widget
    device_widget: device_widget
    BoxLayout:
        orientation: 'vertical'
        HeaderWidget:
            id: header_widget
            size_hint_y: .1
            host_address: root.host_address
            device_name: root.device_name
            on_host_address: root.host_address = self.host_address
            connected: root.connected
            on_connected:
                if self.connected and not root.connected: root.connect()
                elif not self.connected and root.connected: root.disconnect()
        BoxLayout:
            id: main_widget
            size_hint_y: .92
            DeviceWidget:
                id: device_widget
                device: root.device
                connected: root.connected
        FooterWidget:
            id: footer_widget
            size_hint_y: .08
            device_name: root.device_name

<HeaderWidget@BoxLayout>:
    app: app
    orientation: 'horizontal'
    host_address: ''
    device_name: ''
    connected: False
    BoxLayout:
        orientation: 'horizontal'
        size_hint_x: .3
        Label:
            text: 'Device Address'
            font_size: '13sp'
            size_hint_x: .4
        TextInput:
            size_hint_x: .5
            multiline: False
            text: root.host_address
            on_focus: if not self.focus: root.host_address = self.text
    Widget:
        size_hint_x: .3
    Button:
        size_hint_x: .2
        text: 'Disconnect' if root.connected else 'Connect'
        on_release: root.connected = not root.connected
    Button:
        size_hint_x: .2
        text: 'Settings'
        on_release: app.open_settings()

<DeviceSelector>:

<DeviceSelectorButton>:
    text: self.name
    size_hint_y: None
    height: '40dp'
    background_color: [.5,.5,.5,1] if self.is_selected else [1,1,1,1]

<FooterWidget@BoxLayout>:
    orientation: 'horizontal'
    device_name: ''
    Label:
        font_size: '13sp'
        text: root.device_name
    Button:
        text: 'Network Devices'
        on_release: app.root.device_selector.open(self)

<DeviceWidget>:
    app: app
    orientation: 'vertical'
    transport_widget: transport_widget
    clip_list: clip_list
    canvas.before:
        Color:
            rgba: (1, 1, 1, 1)
        Line:
            rectangle: (self.x, self.y, self.width, self.height)
    ClipList:
        id: clip_list
        size_hint_y: .5
        device: root.device
        current_clip_name: transport_widget.clip_name
    TransportWidget:
        id: transport_widget
        size_hint_y: .5
        device: root.device
        connected: root.connected
